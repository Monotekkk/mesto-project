(()=>{"use strict";function e(e,t){e.disabled=!0,e.classList.add(t)}function t(t,n,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(r.inactiveButtonClass)):e(n,r.inactiveButtonClass)}var n={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"b879d976-9451-46e7-99e2-ffc6de83a372","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var o=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{headers:n.headers,method:"PUT"}).then((function(e){return r(e)}))},c=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{headers:n.headers,method:"DELETE"}).then((function(e){return r(e)}))},u=function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{headers:n.headers,method:"DELETE"}).then((function(e){return console.log(e),r(e)}))},a=function(){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-23/cards",{headers:n.headers,method:"GET"}).then((function(e){return r(e)}))},l=function(){return fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers,method:"GET"}).then((function(e){return r(e)}))},i=function(e,t,r){return fetch("".concat(n.baseUrl,"/").concat(r),{method:"PATCH",headers:n.headers,body:JSON.stringify(e)})};Promise.all([l(),a()]);var s=document.querySelector("#name-input"),d=document.querySelector("#about-input"),p=document.querySelector("#updateAvatar-input"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__profi"),_=document.querySelector(".profile__avatar"),v=document.querySelector(".popup_edit-profile"),y=document.querySelector(".popup_update-avatar"),h=document.querySelector(".popup_add-card");function S(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",b)}function q(e){e.classList.add("popup_opened"),document.addEventListener("keydown",b)}function b(e){"Escape"===e.key&&S(document.querySelector(".popup_opened"))}var E=document.querySelector(".popup__image"),g=document.querySelector(".popup__title_image"),L=document.querySelector(".elements"),k=document.querySelector(".popup_image"),C=document.querySelector(".popup_add-card"),A=C.querySelector(".popup__button"),x=document.querySelector("#elementsTemplate").content;function T(e,t){var n=e.link,r=e.name,a=e._id,l=e.owner._id,i=e.likes;L.prepend(function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5?arguments[5]:void 0,i=x.querySelector(".element").cloneNode(!0),s=i.querySelector(".element__image");return s.src=e,s.alt=t,i.querySelector(".element__attractions").textContent=t,i.querySelector(".element__likes").textContent=a.length,a.forEach((function(e){e._id==l&&i.querySelector(".element__like").classList.add("element__like_active")})),i.querySelector(".element__like").addEventListener("click",(function(e){e.target.classList.contains("element__like_active")?c(n).then((function(t){i.querySelector(".element__likes").textContent=t.likes.length,e.target.classList.remove("element__like_active")})).catch((function(e){console.log(e)})):o(n).then((function(e){i.querySelector(".element__likes").textContent=e.likes.length})).then((function(){e.target.classList.add("element__like_active")}))})),r!=l&&r?i.querySelector(".element__trash").classList.add("element__trash_hidden"):i.querySelector(".element__trash").addEventListener("click",(function(){!function(e,t){u(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))}(i,n)})),i.querySelector(".element__image").addEventListener("click",(function(){!function(e,t){q(k),E.src=e,g.textContent=t,E.alt=t}(e,t)})),i}(n,r,a,l,i,t))}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var j,w=document.querySelectorAll(".popup__button_close"),O=document.querySelector(".popup_add-card"),P=document.querySelectorAll(".popup"),N=document.querySelector(".profile__edit-button"),B=document.querySelector("#formEditProfile"),D=document.querySelector(".profile__add-button"),H=document.querySelector("#placeName-input"),M=document.querySelector("#placeHref-input"),I=(O.querySelector(".popup__button"),document.querySelector(".profile__name")),G=document.querySelector(".profile__profi"),J=document.querySelector("#formUpdateAvatar"),V=document.querySelector(".profile__avatar"),z=document.querySelector(".profile__avatar-button");B.addEventListener("submit",(function(e){e.preventDefault(),v.querySelector(".popup__button").value="Сохранение...",i({name:s.value,about:d.value},0,"users/me").then((function(){f.textContent=s.value,m.textContent=d.value,S(v)})).catch((function(e){console.log(e)})).finally((function(){v.querySelector(".popup__button").value="Сохранить"}))})),J.addEventListener("submit",(function(){y.querySelector(".popup__button").value="Сохранение...",i({avatar:p.value},0,"users/me/avatar").then((function(){_.src=p.value,S(y)})).catch((function(e){console.log(e)})).finally((function(){y.querySelector(".popup__button").value="Сохранить"}))})),w.forEach((function(e){return e.addEventListener("click",(function(e){S(document.querySelector(".popup_opened"))}))})),N.addEventListener("click",(function(){s.value=f.textContent,d.value=m.textContent,q(v)})),D.addEventListener("click",(function(){q(h)})),O.addEventListener("submit",(function(t){t.preventDefault(),function(t,o){var c,u;C.querySelector(".popup__button").value="Сохранение...",(c=t.placeName,u=t.placeHref,fetch("".concat(n.baseUrl,"/cards/"),{headers:n.headers,method:"POST",body:JSON.stringify({name:c,link:u})}).then((function(e){return r(e)}))).then((function(t){T(t,t.owner._id),o.target.reset(),e(A,"popup__button_inactive"),S(C)})).catch((function(e){console.log(e)})).finally((function(){C.querySelector(".popup__button").value="Сохранить"}))}({placeHref:M.value,placeName:H.value},t)})),P.forEach((function(e){e.addEventListener("click",(function(e){S(e.target)}))})),z.addEventListener("click",(function(){q(document.querySelector(".popup_update-avatar"))})),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var r=Array.from(e.querySelectorAll(n.inputSelector)),o=e.querySelector(n.submitButtonSelector);t(r,o,n),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=" "}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,c,n),t(r,o,n)}))}))}(e,j)})),Promise.all([l(),a()]).then((function(e){var t,n,r,o,c=(o=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,a=[],l=!0,i=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){i=!0,o=e}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(i)throw o}}return a}}(r,o)||function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],a=c[1];I.textContent=u.name,G.textContent=u.about,V.src=u.avatar,t=a.revers(),n=u._id,t.forEach((function(e){T(e,n)}))})).catch((function(e){console.log(e)}))})();